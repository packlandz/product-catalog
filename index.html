<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Product Catalog</title>
  <style>
    body {
      margin: 0; font-family: Arial, sans-serif; background: #f5f5f5;
      display: flex; flex-direction: column; min-height: 100vh;
    }
    header {
      background: #111; color: white; padding: 1rem; text-align: center;
      font-size: 1.8rem; font-weight: bold;
    }
    main {
      flex: 1; display: flex; padding: 1rem; gap: 1rem;
      max-width: 1300px; margin: 0 auto;
    }
    /* Left main content */
    .content {
      flex: 1; display: flex; flex-direction: column;
    }
    /* Tabs */
    .tabs {
      display: flex; flex-wrap: wrap; gap: 0.7rem; margin-bottom: 1rem;
    }
    .tab {
      padding: 0.5rem 1.2rem; border-radius: 5px;
      border: 1px solid #ddd; background: white; cursor: pointer;
      user-select: none;
      transition: background 0.3s, color 0.3s;
    }
    .tab.active {
      background: #111; color: white; border-color: #111;
    }
    /* Search bar */
    .search-bar {
      margin-bottom: 1rem;
    }
    .search-bar input {
      width: 100%; padding: 0.5rem 1rem; font-size: 1rem;
      border-radius: 6px; border: 1px solid #ccc;
      box-sizing: border-box;
    }
    /* Product list grid */
    .product-list {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
      gap: 1.3rem;
      flex-grow: 1;
      overflow-y: auto;
      max-height: 500px;
      background: white;
      padding: 1rem;
      border-radius: 10px;
      box-shadow: 0 3px 6px rgb(0 0 0 / 0.1);
    }
    /* Product card */
    .product {
      background: white; border-radius: 10px; box-shadow: 0 4px 8px rgb(0 0 0 / 0.1);
      display: flex; flex-direction: column; align-items: center; padding: 1rem;
      transition: transform 0.2s ease;
      user-select: none;
    }
    .product:hover {
      transform: translateY(-5px);
    }
    .product img {
      width: 100%; height: 160px; object-fit: cover; border-radius: 8px;
      margin-bottom: 0.7rem;
    }
    .product-info {
      text-align: center; font-size: 0.95rem; color: #333;
      flex-grow: 1;
    }
    .product-info strong {
      display: block; font-size: 1.15rem; margin-bottom: 0.4rem;
    }
    /* Product buttons */
    .product-actions {
      margin-top: 0.7rem; display: flex; justify-content: center; gap: 0.5rem;
    }
    .product-actions button {
      background: #111; color: white; border: none; padding: 0.4rem 0.8rem;
      border-radius: 5px; cursor: pointer; transition: background 0.2s ease;
      font-size: 0.9rem;
    }
    .product-actions button:hover {
      background: #333;
    }
    /* Sidebar */
    .sidebar {
      width: 300px; background: white; padding: 1rem;
      border-radius: 10px; box-shadow: 0 3px 6px rgb(0 0 0 / 0.1);
      display: flex; flex-direction: column; gap: 1rem;
      height: fit-content;
      position: sticky; top: 1rem;
    }
    .form-group {
      display: flex; flex-direction: column; margin-bottom: 1rem;
    }
    .form-group label {
      font-weight: bold; margin-bottom: 0.3rem;
    }
    .form-group input,
    .form-group textarea,
    .form-group select {
      padding: 0.5rem; font-size: 1rem;
      border-radius: 5px; border: 1px solid #ccc;
      resize: vertical;
    }
    .form-group textarea {
      min-height: 60px;
    }
    button#saveProduct {
      background: #111; color: white; border: none;
      padding: 0.6rem 1rem; font-size: 1.1rem; border-radius: 7px;
      cursor: pointer; transition: background 0.3s ease;
    }
    button#saveProduct:hover {
      background: #333;
    }
    /* Pagination */
    .pagination {
      margin-top: 1rem;
      display: flex;
      justify-content: center;
      gap: 0.5rem;
      user-select: none;
    }
    .pagination button {
      padding: 0.4rem 0.9rem;
      border-radius: 5px;
      border: 1px solid #ccc;
      background: white;
      cursor: pointer;
      font-weight: bold;
      transition: background 0.2s ease;
    }
    .pagination button.active {
      background: #111;
      color: white;
      border-color: #111;
    }
    .pagination button:hover:not(.active) {
      background: #eee;
    }
    /* Telegram sidebar link */
    .telegram-link {
      text-align: center;
      margin-top: auto;
      font-weight: bold;
      font-size: 1rem;
    }
    .telegram-link a {
      text-decoration: none;
      color: #0088cc;
    }
    .telegram-link a:hover {
      text-decoration: underline;
    }
  </style>
</head>
<body>
  <header>Product Catalog</header>
  <main>
    <section class="content">
      <nav class="tabs">
        <div class="tab active" data-category="all">All</div>
        <div class="tab" data-category="Best Sellers">Best Sellers</div>
        <div class="tab" data-category="Flower">Flower</div>
        <div class="tab" data-category="Concentrates">Concentrates</div>
        <div class="tab" data-category="Carts">Carts</div>
        <div class="tab" data-category="Disposables">Disposables</div>
        <div class="tab" data-category="Edibles">Edibles</div>
        <div class="tab" data-category="Miscellaneous">Miscellaneous</div>
      </nav>

      <div class="search-bar">
        <input type="text" placeholder="Search products by name..." id="searchInput" />
      </div>

      <div class="product-list" aria-live="polite">
        <!-- Products will be inserted here -->
      </div>

      <div class="pagination" aria-label="Pagination">
        <!-- Pagination buttons -->
      </div>
    </section>

    <aside class="sidebar" aria-label="Add or edit product form and telegram link">
      <h2 id="formTitle">Add New Product</h2>

      <div class="form-group">
        <label for="productName">Product Name*</label>
        <input type="text" id="productName" placeholder="Product Name" />
      </div>
      <div class="form-group">
        <label for="productBrand">Brand*</label>
        <input type="text" id="productBrand" placeholder="Brand" />
      </div>
      <div class="form-group">
        <label for="productDescription">Description*</label>
        <textarea id="productDescription" placeholder="Description"></textarea>
      </div>
      <div class="form-group">
        <label for="productPrice">Price* (numbers only)</label>
        <input type="number" id="productPrice" placeholder="Price" min="0" step="0.01" />
      </div>
      <div class="form-group">
        <label for="productImage">Image URL*</label>
        <input type="text" id="productImage" placeholder="Image URL" />
      </div>
      <div class="form-group">
        <label for="productCategory">Category*</label>
        <select id="productCategory">
          <option value="Best Sellers">Best Sellers</option>
          <option value="Flower">Flower</option>
          <option value="Concentrates">Concentrates</option>
          <option value="Carts">Carts</option>
          <option value="Disposables">Disposables</option>
          <option value="Edibles">Edibles</option>
          <option value="Miscellaneous">Miscellaneous</option>
        </select>
      </div>

      <button id="saveProduct">Add Product</button>

      <div class="telegram-link" style="margin-top: 2rem;">
        <p>Contact on Telegram:</p>
        <a href="https://t.me/YOUR_TELEGRAM_USERNAME" target="_blank" rel="noopener noreferrer">@YOUR_TELEGRAM_USERNAME</a>
      </div>
    </aside>
  </main>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js";
    import {
      getFirestore,
      collection,
      addDoc,
      getDocs,
      doc,
      updateDoc,
      deleteDoc,
      query,
      orderBy
    } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore.js";

    // --- REPLACE WITH YOUR FIREBASE CONFIG ---
    const firebaseConfig = {
      apiKey: "AIzaSyBg--ptpq9wlQNH1HK-SRe88aDx1_yO7yQ",
      authDomain: "project-3390921463634312663.firebaseapp.com",
      projectId: "project-3390921463634312663",
      storageBucket: "project-3390921463634312663.firebasestorage.app",
      messagingSenderId: "451857573630",
      appId: "1:451857573630:web:94f4ee25f65ef4967ae7af"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    // DOM elements
    const productList = document.querySelector(".product-list");
    const saveBtn = document.getElementById("saveProduct");
    const formTitle = document.getElementById("formTitle");

    const productName = document.getElementById("productName");
    const productBrand = document.getElementById("productBrand");
    const productDescription = document.getElementById("productDescription");
    const productPrice = document.getElementById("productPrice");
    const productImage = document.getElementById("productImage");
    const productCategory = document.getElementById("productCategory");

    const tabs = document.querySelectorAll(".tab");
    const searchInput = document.getElementById("searchInput");
    const paginationContainer = document.querySelector(".pagination");

    // Pagination config
    const PRODUCTS_PER_PAGE = 5;
    let currentPage = 1;

    // State
    let products = []; // all fetched products
    let filteredProducts = []; // filtered after category and search
    let editProductId = null; // null means add mode; non-null means edit mode
    let currentCategory = "all";

    // Fetch all products from Firestore, ordered by createdAt desc
    async function fetchProducts() {
      try {
        const q = query(collection(db, "products"), orderBy("createdAt", "desc"));
        const snapshot = await getDocs(q);
        products = snapshot.docs.map(doc => ({
          id: doc.id,
          ...doc.data()
        }));
        applyFilters();
      } catch (error) {
        console.error("Error fetching products:", error);
        productList.innerHTML = "<p style='color:red;'>Error loading products.</p>";
      }
    }

    // Apply category & search filter
    function applyFilters() {
      filteredProducts = products.filter(product => {
        const matchCategory = currentCategory === "all" || product.category === currentCategory;
        const searchTerm = searchInput.value.trim().toLowerCase();
        const matchSearch = product.name.toLowerCase().includes(searchTerm);
        return matchCategory && matchSearch;
      });
      currentPage = 1;
      renderProducts();
      renderPagination();
    }

    // Render products on current page
    function renderProducts() {
      productList.innerHTML = "";
      if (filteredProducts.length === 0) {
        productList.innerHTML = "<p>No products found.</p>";
        return;
      }
      const start = (currentPage - 1) * PRODUCTS_PER_PAGE;
      const end = start + PRODUCTS_PER_PAGE;
      const pageProducts = filteredProducts.slice(start, end);

      pageProducts.forEach(product => {
        const productCard = document.createElement("div");
        productCard.className = "product";

        productCard.innerHTML = `
          <img src="${product.image || "https://via.placeholder.com/250x160?text=No+Image"}" alt="${product.name}">
          <div class="product-info">
            <strong>${product.name}</strong>
            Brand: ${product.brand}<br>
            $${product.price.toFixed(2)}<br>
            Category: ${product.category}
          </div>
          <div class="product-actions">
            <button class="edit-btn" data-id="${product.id}">Edit</button>
            <button class="delete-btn" data-id="${product.id}">Delete</button>
          </div>
        `;

        productList.appendChild(productCard);
      });

      // Add event listeners to edit/delete buttons
      document.querySelectorAll(".edit-btn").forEach(btn => {
        btn.addEventListener("click", () => {
          startEditProduct(btn.dataset.id);
        });
      });

      document.querySelectorAll(".delete-btn").forEach(btn => {
        btn.addEventListener("click", () => {
          if (confirm("Are you sure you want to delete this product?")) {
            deleteProduct(btn.dataset.id);
          }
        });
      });
    }

    // Render pagination buttons
    function renderPagination() {
      paginationContainer.innerHTML = "";
      const totalPages = Math.ceil(filteredProducts.length / PRODUCTS_PER_PAGE);
      if (totalPages <= 1) return;

      for (let i = 1; i <= totalPages; i++) {
        const btn = document.createElement("button");
        btn.textContent = i;
        btn.className =
