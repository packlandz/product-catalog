<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Product Catalog</title>
<style>
  body {
    font-family: Arial, sans-serif;
    margin: 0; 
    padding: 20px; 
    background: #f9f9f9;
  }
  header {
    text-align: center;
    margin-bottom: 15px;
  }
  /* Tabs */
  .tabs {
    display: flex;
    justify-content: center;
    margin-bottom: 20px;
    gap: 15px;
  }
  .tab {
    padding: 8px 16px;
    cursor: pointer;
    border-bottom: 2px solid transparent;
    font-weight: bold;
    color: #555;
  }
  .tab.active {
    border-color: #007bff;
    color: #007bff;
  }
  /* Container with main and sidebar */
  .container {
    display: flex;
    gap: 20px;
  }
  /* Main content */
  .main-content {
    flex: 1;
  }
  /* Sidebar */
  .sidebar {
    width: 200px;
    background: #fff;
    border: 1px solid #ddd;
    padding: 15px;
    box-shadow: 0 0 6px rgba(0,0,0,0.05);
  }
  .sidebar h3 {
    margin-top: 0;
    margin-bottom: 10px;
    font-size: 1.1em;
  }
  .sidebar a {
    display: block;
    margin-bottom: 8px;
    color: #007bff;
    text-decoration: none;
  }
  .sidebar a:hover {
    text-decoration: underline;
  }

  /* Form */
  form {
    background: white;
    padding: 15px;
    border: 1px solid #ddd;
    margin-bottom: 20px;
    max-width: 600px;
  }
  form label {
    display: block;
    margin: 8px 0 4px;
    font-weight: bold;
  }
  form input, form select, form textarea {
    width: 100%;
    padding: 6px;
    border: 1px solid #ccc;
    border-radius: 3px;
    box-sizing: border-box;
  }
  form textarea {
    resize: vertical;
  }
  form button {
    margin-top: 12px;
    padding: 10px 16px;
    background: #007bff;
    border: none;
    color: white;
    font-weight: bold;
    cursor: pointer;
    border-radius: 3px;
  }
  form button:disabled {
    background: #999;
    cursor: not-allowed;
  }

  /* Search */
  #searchInput {
    width: 300px;
    padding: 8px;
    margin-bottom: 20px;
    border-radius: 3px;
    border: 1px solid #ccc;
  }

  /* Products grid 4x4 */
  .product-list {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 15px;
  }
  .product {
    background: white;
    border: 1px solid #ddd;
    padding: 10px;
    box-sizing: border-box;
    box-shadow: 0 1px 3px rgba(0,0,0,0.1);
    display: flex;
    flex-direction: column;
    justify-content: space-between;
  }
  .product img {
    width: 100%;
    height: 120px;
    object-fit: cover;
    margin-bottom: 8px;
    border-radius: 3px;
  }
  .product-info {
    font-size: 0.9em;
    color: #333;
    flex-grow: 1;
  }
  .product-actions {
    margin-top: 8px;
    display: flex;
    justify-content: space-between;
  }
  .product-actions button {
    padding: 5px 10px;
    font-size: 0.8em;
    cursor: pointer;
    border: none;
    border-radius: 3px;
  }
  .edit-btn {
    background: #ffc107;
    color: #333;
  }
  .delete-btn {
    background: #dc3545;
    color: white;
  }

  /* Pagination */
  .pagination {
    margin-top: 15px;
    text-align: center;
  }
  .pagination button {
    margin: 0 3px;
    padding: 6px 12px;
    border: 1px solid #007bff;
    background: white;
    color: #007bff;
    cursor: pointer;
    border-radius: 3px;
  }
  .pagination button.active {
    background: #007bff;
    color: white;
  }

</style>
</head>
<body>

<header>
  <h1>Product Catalog</h1>
</header>

<!-- Tabs for categories -->
<div class="tabs">
  <div class="tab active" data-category="all">All</div>
  <div class="tab" data-category="Best Sellers">Best Sellers</div>
  <div class="tab" data-category="Flower">Flower</div>
  <div class="tab" data-category="Concentrates">Concentrates</div>
  <div class="tab" data-category="Carts">Carts</div>
  <div class="tab" data-category="Disposables">Disposables</div>
  <div class="tab" data-category="Edibles">Edibles</div>
  <div class="tab" data-category="Miscellaneous">Miscellaneous</div>
</div>

<div class="container">

  <main class="main-content">
    <!-- Add/Edit Product Form -->
    <form id="productForm" style="display:none;">
      <h2 id="formTitle">Add New Product</h2>

      <label for="productName">Name</label>
      <input type="text" id="productName" required />

      <label for="productBrand">Brand</label>
      <input type="text" id="productBrand" required />

      <label for="productDescription">Description</label>
      <textarea id="productDescription" rows="3" required></textarea>

      <label for="productPrice">Price</label>
      <input type="number" step="0.01" id="productPrice" required />

      <label for="productImage">Image URL</label>
      <input type="url" id="productImage" required />

      <label for="productCategory">Category</label>
      <select id="productCategory" required>
        <option>Best Sellers</option>
        <option>Flower</option>
        <option>Concentrates</option>
        <option>Carts</option>
        <option>Disposables</option>
        <option>Edibles</option>
        <option>Miscellaneous</option>
      </select>

      <button type="button" id="saveProduct">Add Product</button>
    </form>

    <!-- Search -->
    <input type="text" id="searchInput" placeholder="Search products..." />

    <!-- Products Grid -->
    <div class="product-list"></div>

    <!-- Pagination -->
    <div class="pagination"></div>
  </main>

  <!-- Sidebar with links -->
  <aside class="sidebar">
    <h3>Useful Links</h3>
    <a href="https://t.me/yourtelegram" target="_blank" rel="noopener noreferrer">Telegram</a>
    <a href="https://example.com/anotherlink" target="_blank" rel="noopener noreferrer">Another Link</a>
    <!-- Add more links as you want -->
  </aside>

</div>

<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js";
  import {
    getFirestore,
    collection,
    addDoc,
    getDocs,
    doc,
    updateDoc,
    deleteDoc,
    query,
    orderBy,
    serverTimestamp
  } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore.js";

  // Your Firebase config
  const firebaseConfig = {
    apiKey: "AIzaSyBg--ptpq9wlQNH1HK-SRe88aDx1_yO7yQ",
    authDomain: "project-3390921463634312663.firebaseapp.com",
    projectId: "project-3390921463634312663",
    storageBucket: "project-3390921463634312663.appspot.com",
    messagingSenderId: "451857573630",
    appId: "1:451857573630:web:94f4ee25f65ef4967ae7af"
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  const productList = document.querySelector(".product-list");
  const saveBtn = document.getElementById("saveProduct");
  const formTitle = document.getElementById("formTitle");
  const productForm = document.getElementById("productForm");

  const productName = document.getElementById("productName");
  const productBrand = document.getElementById("productBrand");
  const productDescription = document.getElementById("productDescription");
  const productPrice = document.getElementById("productPrice");
  const productImage = document.getElementById("productImage");
  const productCategory = document.getElementById("productCategory");

  const tabs = document.querySelectorAll(".tab");
  const searchInput = document.getElementById("searchInput");
  const paginationContainer = document.querySelector(".pagination");

  const PRODUCTS_PER_PAGE = 16; // 4x4 grid = 16 per page
  let currentPage = 1;
  let products = [];
  let filteredProducts = [];
  let editProductId = null;
  let currentCategory = "all";

  // Show form only if user is "admin" â€” change this to your condition
  // Example: show form only if URL contains ?admin=true
  function isAdmin() {
    return new URLSearchParams(window.location.search).get('admin') === 'true';
  }

  if(isAdmin()){
    productForm.style.display = "block";
  }

  async function fetchProducts() {
    try {
      const q = query(collection(db, "products"), orderBy("createdAt", "desc"));
      const snapshot = await getDocs(q);
      products = snapshot.docs.map(doc => ({
        id: doc.id,
        ...doc.data()
      }));
      applyFilters();
    } catch (error) {
      console.error("Error fetching products:", error);
      productList.innerHTML = "<p style='color:red;'>Error loading products.</p>";
    }
  }

  function applyFilters() {
    filteredProducts = products.filter(product => {
      const matchCategory = currentCategory === "all" || product.category === currentCategory;
      const searchTerm = searchInput.value.trim().toLowerCase();
      const matchSearch = product.name.toLowerCase().includes(searchTerm);
      return matchCategory && matchSearch;
    });
    currentPage = 1;
    renderProducts();
    renderPagination();
  }

  function renderProducts() {
    productList.innerHTML = "";
    if (filteredProducts.length === 0) {
      productList.innerHTML = "<p>No products found.</p>";
      return;
    }
    const start = (currentPage - 1) * PRODUCTS_PER_PAGE;
    const end = start + PRODUCTS_PER_PAGE;
    const pageProducts = filteredProducts.slice(start, end);

    pageProducts.forEach(product => {
      const productCard = document.createElement("div");
      productCard.className = "product";

      productCard.innerHTML = `
        <img src="${product.image || "https://via.placeholder.com/250x160?text=No+Image"}" alt="${product.name}">
        <div class="product-info">
          <strong>${product.name}</strong><br>
          Brand: ${product.brand}<br>
          $${product.price.toFixed(2)}<br>
          Category: ${product.category}
        </div>
        ${isAdmin() ? `
        <div class="product-actions">
          <button class="edit-btn" data-id="${product.id}">Edit</button>
          <button class="delete-btn" data-id="${product.id}">Delete</button>
        </
