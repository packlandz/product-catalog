<h1>Product Catalog</h1>
<nav id="category-nav">
  <a href="#all">All</a>
  <a href="#best-sellers">Best Sellers</a>
  <a href="#flower">Flower</a>
  <a href="#concentrates">Concentrates</a>
  <a href="#carts">Carts</a>
  <a href="#disposables">Disposables</a>
  <a href="#edibles">Edibles</a>
  <a href="#misc">Miscellaneous</a>
</nav>

<div id="product-container"></div>

<h2>Add / Edit Product</h2>
<form id="product-form">
  <input type="hidden" id="editIndex" />
  <input type="text" id="name" placeholder="Product Name" required />
  <input type="text" id="brand" placeholder="Brand" required />
  <textarea id="desc" placeholder="Description" required></textarea>
  <input type="number" id="price" placeholder="Price" step="0.01" required />
  <input type="text" id="image" placeholder="Image URL" required />
  <input type="file" id="imageUpload" accept="image/*" />
  <img id="preview" src="" alt="Preview" style="max-width:100%;margin-bottom:15px;display:none;border-radius:8px;" />
  <select id="category" required>
    <option value="">Select Category</option>
    <option value="best-sellers">Best Sellers</option>
    <option value="flower">Flower</option>
    <option value="concentrates">Concentrates</option>
    <option value="carts">Carts</option>
    <option value="disposables">Disposables</option>
    <option value="edibles">Edibles</option>
    <option value="misc">Miscellaneous</option>
  </select>
  <button type="submit">Save Product</button>
</form>

<script>
  let products = [];

  function renderProducts(category = "all") {
    const container = document.getElementById("product-container");
    container.innerHTML = "";

    const filtered = category === "all" ? products : products.filter(p => p.category === category);

    if (filtered.length === 0) {
      container.innerHTML = `<p style="text-align:center;">No products in this category.</p>`;
      return;
    }

    filtered.forEach((product, index) => {
      const card = document.createElement("div");
      card.className = "product-card";
      card.innerHTML = `
        <img src="${product.image}" alt="${product.name}">
        <h2>${product.name}</h2>
        <p class="brand">${product.brand}</p>
        <p class="description">${product.desc}</p>
        <span class="price">$${product.price.toFixed(2)}</span>
        <div>
          <button class="btn edit" onclick="editProduct(${index})">Edit</button>
          <button class="btn delete" onclick="deleteProduct(${index})">Delete</button>
        </div>
      `;
      container.appendChild(card);
    });
  }

  function handleHashChange() {
    const category = location.hash.replace("#", "") || "all";
    renderProducts(category);
  }

  function editProduct(index) {
    const p = products[index];
    document.getElementById('editIndex').value = index;
    document.getElementById('name').value = p.name;
    document.getElementById('brand').value = p.brand;
    document.getElementById('desc').value = p.desc;
    document.getElementById('price').value = p.price;
    document.getElementById('image').value = p.image;
    document.getElementById('category').value = p.category;
    document.getElementById('preview').src = p.image;
    document.getElementById('preview').style.display = 'block';
    window.scrollTo({ top: document.body.scrollHeight, behavior: 'smooth' });
  }

  function deleteProduct(index) {
    if (confirm("Delete this product?")) {
      products.splice(index, 1);
      handleHashChange();
    }
  }

  document.getElementById("imageUpload").addEventListener("change", function () {
    const file = this.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = function (e) {
        document.getElementById("image").value = e.target.result;
        document.getElementById("preview").src = e.target.result;
        document.getElementById("preview").style.display = 'block';
      };
      reader.readAsDataURL(file);
    }
  });

  document.getElementById("product-form").addEventListener("submit", function(e) {
    e.preventDefault();
    const name = document.getElementById('name').value.trim();
    const brand = document.getElementById('brand').value.trim();
    const desc = document.getElementById('desc').value.trim();
    const price = parseFloat(document.getElementById('price').value);
    const image = document.getElementById('image').value.trim();
    const category = document.getElementById('category').value;
    const index = document.getElementById('editIndex').value;

    const product = { name, brand, desc, price, image, category };

    if (index) {
      products[index] = product;
    } else {
      products.push(product);
    }

    this.reset();
    document.getElementById('editIndex').value = '';
    document.getElementById('preview').style.display = 'none';
    handleHashChange();
  });

  window.addEventListener("hashchange", handleHashChange);
  window.addEventListener("load", handleHashChange);
</script>
